C51 COMPILER V9.60.7.0   18B20                                                             09/24/2024 17:32:50 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE 18B20
OBJECT MODULE PLACED IN .\Objects\18B20.obj
COMPILER INVOKED BY: E:\ARM_KEIL\Arm\Keil_v5\C51\BIN\C51.EXE source\18B20.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND 
                    -PRINT(.\Listings\18B20.lst) TABS(2) OBJECT(.\Objects\18B20.obj)

line level    source

   1          /*18B20.c*/
   2          #include "include/delay.h"
   3          #include "include/18B20.h"
   4          
   5          bit Init_DS18B20(void)
   6          {
   7   1          // 初始化变量dat为0
   8   1          bit dat = 0;
   9   1      
  10   1          // 将DQ置为高电平
  11   1          DQ = 1;
  12   1          // 延时5微秒
  13   1          DelayUs2x(5);
  14   1      
  15   1          // 将DQ置为低电平
  16   1          DQ = 0;
  17   1          // 延时200微秒
  18   1          DelayUs2x(200);
  19   1          // 延时200微秒
  20   1          DelayUs2x(200);
  21   1      
  22   1          // 将DQ置为高电平
  23   1          DQ = 1;
  24   1          // 延时50微秒
  25   1          DelayUs2x(50);
  26   1      
  27   1          // 读取DQ的值赋给dat
  28   1          dat = DQ;
  29   1          // 延时25微秒
  30   1          DelayUs2x(25);
  31   1      
  32   1          // 返回dat的值
  33   1          return dat;
  34   1      }
  35          
  36          unsigned char ReadOneChar(void)
  37          {
  38   1          unsigned char i = 0;
  39   1          unsigned char dat = 0;
  40   1          // 循环8次，每次读取一位数据
  41   1          for(i = 8; i > 0; i--) {
  42   2              // 将DQ置为0
  43   2              DQ = 0;
  44   2              // 将dat右移一位
  45   2              dat >>= 1;
  46   2              // 将DQ置为1
  47   2              DQ = 1;
  48   2              // 如果DQ为高电平，则将dat的最高位设为1
  49   2              if(DQ)
  50   2                  dat |= 0x80;
  51   2              // 延时25微秒
  52   2              DelayUs2x(25);
  53   2          }
  54   1          // 返回读取到的字符
C51 COMPILER V9.60.7.0   18B20                                                             09/24/2024 17:32:50 PAGE 2   

  55   1          return(dat);
  56   1      }
  57          
  58          void WriteOneChar(unsigned char dat)
  59          {
  60   1          unsigned char i = 0;
  61   1          for(i = 8; i > 0; i--) {
  62   2              DQ = 0;
  63   2              DQ = dat & 0x01;
  64   2              DelayUs2x(25);
  65   2              DQ = 1;
  66   2              dat >>= 1;
  67   2          }
  68   1          DelayUs2x(25);
  69   1      }
  70          
  71          unsigned int ReadTemperature(void) {
  72   1          unsigned char a = 0;
  73   1          unsigned int b = 0;
  74   1          unsigned int t = 0;
  75   1      
  76   1          // 初始化温度传感器
  77   1          if (!Init_DS18B20()) {
  78   2              // 处理初始化错误
  79   2              return 0xFFFF; // 返回错误代码
  80   2          }
  81   1      
  82   1          WriteOneChar(0xCC);
  83   1          WriteOneChar(0x44);
  84   1          DelayMs(10);
  85   1      
  86   1          Init_DS18B20();
  87   1          WriteOneChar(0xCC);
  88   1          WriteOneChar(0xBE);
  89   1          a = ReadOneChar();
  90   1          b = ReadOneChar();
  91   1          b <<= 8;
  92   1          t = a + b;
  93   1      
  94   1          // 检查温度值的有效性
  95   1          if (t < 0 || t > 1000) { // 假设有效温度范围
  96   2              return 0xFFFF; // 返回错误代码
  97   2          }
  98   1      
  99   1          return t;
 100   1      }
 101          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    228    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
